<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE rfc SYSTEM "rfc2629-xhtml.ent">

<?rfc toc="yes"?>
<?rfc tocompact="yes"?>
<?rfc tocdepth="3"?>
<?rfc tocindent="yes"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes"?>
<?rfc comments="yes"?>
<?rfc inline="yes"?>
<?rfc compact="no"?>
<?rfc subcompact="no"?>
<?rfc authorship="yes"?>
<?rfc tocappendix="yes"?>
<rfc  xmlns:xi="http://www.w3.org/2001/XInclude" category="std" ipr='trust200902' tocInclude="true"  obsoletes="" updates="8138" consensus="true" submissionType="IETF" xml:lang="en" version="3" docName="draft-ietf-roll-turnon-rfc8138-09">
<front>

   <title abbrev='Turn On 6LoRH'>A RPL DODAG Configuration Option for the 6LoWPAN Routing Header</title>


   <author fullname='Pascal Thubert' initials='P.' role='editor' surname='Thubert'>
      <organization abbrev='Cisco Systems'>Cisco Systems, Inc</organization>
      <address>
         <postal>
            <street>Building D</street>
            <street>45 Allee des Ormes - BP1200 </street>
            <city>MOUGINS - Sophia Antipolis</city>
            <code>06254</code>
            <country>FRANCE</country>
         </postal>
         <phone>+33 497 23 26 34</phone>
         <email>pthubert@cisco.com</email>
      </address>
   </author>

          <author initials='L' surname='Zhao' fullname='Li Zhao'>
          <organization abbrev='Cisco Systems'>Cisco Systems, Inc</organization>
          <address>
             <postal>
                <street>Xinsi Building</street>
                <street>No. 926 Yi Shan Rd </street>
                <city>SHANGHAI </city>
                <code>200233</code>
                <country>CHINA</country>
             </postal>
             <email>liz3@cisco.com</email>
          </address>
       </author>



   <date/>
   <area>Routing Area</area>
   <workgroup>ROLL</workgroup>
   <keyword>Draft</keyword>
   <abstract>
      <t>
     This document updates RFC 8138 by defining a bit in the RPL DODAG
     Configuration Option to indicate whether compression is used within the
     RPL Instance, and specify the behavior of RFC 8138-capable nodes
     when the bit is set and reset.

      </t>
   </abstract>
</front>

<middle>
   <section><name>Introduction</name>
      <t>
      The packet compression technique defined in <xref target='RFC8138'/> can
      only be activated in a RPL <xref target='RFC6550'/> network when all the
      nodes support it. Otherwise, a non-capable node acting as leaf-only would
      fail to communicate, and acting as a router it would drop the compressed
      packets and black-hole a portion of the network.
      </t>
      <t>
      The original idea was to use a flag day but that proved impractical in a
      number of situations such as a large metering network that is used in
      production and incurs financial losses when interrupted.
      </t>
      <t>
      This specification is designed for the scenario where a live network is
      upgraded to support <xref target='RFC8138'/>. During the migration, the
      compression should remain inactive, until all nodes are upgraded.
      This document complements <xref target='RFC8138'/> and dedicates a flag in
      the RPL DODAG Configuration Option to indicate whether the
      <xref target='RFC8138'/> compression should be used within the RPL DODAG.
      </t>
      <t>
      The setting of this new flag is controlled by the Root and propagates as
      is in the whole network as part of the normal RPL signaling.
      </t>
      <t>
      The idea is to use the flag to maintain the compression inactive during
      the migration phase. When the migration is complete (e.g., as known by
      network management and/or inventory), the flag is set and the compression
      is globally activated in the whole DODAG.
      </t>
      <!--
      The appendix proposes a method to isolate the legacy nodes that cannot be
      upgraded in a separate instance where the compression remains off.
      Upgraded nodes can participate to that instance as routers but will prefer
      an upgraded instance for their own traffic, so they can use the compression.
       -->

   </section><!-- title="Introduction"-->


<section><name>Terminology</name>

<section anchor='lo'><name>References</name>
<t>
   The Terminology used in this document is consistent with and incorporates
   that described in <xref target='RFC7102'>"Terms Used in Routing for Low-Power
   and Lossy Networks (LLNs)"</xref>.
   Other terms in use in LLNs are found in <xref target='RFC7228'>
   "Terminology for Constrained-Node Networks"</xref>.
</t>



<t>"RPL", the "RPL Packet Information" (RPI), "RPL Instance" (indexed by a
   RPLInstanceID) are defined in <xref target='RFC6550'>"RPL: IPv6 Routing
   Protocol for Low-Power and Lossy Networks"</xref>. The RPI is the abstract
   information that RPL defines to be placed in data packets, e.g., as the RPL
   Option <xref target='RFC6553'/> within the IPv6 Hop-By-Hop Header.
   By extension the term "RPI" is often used to refer to the RPL Option itself.
   The DODAG Information Solicitation (DIS), Destination Advertisement Object
   (DAO) and DODAG Information Object (DIO) messages are also specified in
   <xref target='RFC6550'/>.
</t><t>

   This document uses the terms RPL-Unaware Leaf (RUL) and RPL Aware Leaf
   (RAL) consistently with <xref target='I-D.ietf-roll-useofrplinfo'>
   "Using RPI Option Type, Routing Header for Source Routes and IPv6-in-IPv6 encapsulation in the RPL Data Plane"</xref>.
   The term RPL-Aware Node (RAN) refers to a node that is either
   a RAL or a RPL Router. A RAN manages the reachability of its addresses and
   prefixes by injecting them in RPL by itself. In contrast, a RUL leverages
    <xref target='RFC8505'>"Registration Extensions for IPv6 over
    Low-Power Wireless Personal Area Network (6LoWPAN) Neighbor Discovery"
    </xref> to obtain reachability services from its parent router(s)
    as specified in <xref target='I-D.ietf-roll-unaware-leaves'>
    "Routing for RPL Leaves"</xref>.


</t>


</section>	<!-- end section "References" -->
<section anchor='gloss'><name>Glossary</name>
 <t> This document often uses the following acronyms:
    </t>
    <dl  spacing='compact'>
    <dt>6LoWPAN:</dt><dd>IPv6 over Low-Power Wireless Personal Area Network</dd>
    <dt>6LoRH:</dt><dd>6LoWPAN Routing Header</dd>
    <dt>DIO:</dt><dd> DODAG Information Object (a RPL message) </dd>
    <dt>DODAG:</dt><dd> Destination-Oriented Directed Acyclic Graph </dd>
    <dt>LLN:</dt><dd> Low-Power and Lossy Network </dd>
    <dt>RPL:</dt><dd> IPv6 Routing Protocol for Low-Power and Lossy Networks </dd>
    <dt>OF:</dt><dd> RPL Objective Function</dd>
    <dt>OCP:</dt><dd> RPL Objective Code Point</dd>
    <dt>MOP:</dt><dd> RPL Mode of Operation </dd>
    <dt>RPI:</dt><dd> RPL Packet Information </dd>
    <dt>RAL:</dt><dd> RPL-Aware Leaf </dd>
    <dt>RAN:</dt><dd> RPL-Aware Node  </dd>
    <dt>RUL:</dt><dd> RPL-Unaware Leaf</dd>
    <dt>SRH:</dt><dd>Source Routing Header</dd>


    </dl>
</section>	<!-- end section "Glossary" -->

<section anchor='bcp'><name>Requirements Language</name>
<t>

    The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
    "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
    "OPTIONAL" in this document are to be interpreted as described in BCP 14
 <xref target='RFC2119'/><xref target='RFC8174'/> when, and only when, they
    appear in all capitals, as shown here.

</t>
</section>	<!-- end section "Requirements Language" -->


</section>	<!-- end section "Terminology" -->


   <section><name>The RPL DODAG Configuration Option</name>

   <t>
   The DODAG Configuration Option is defined in Section 6.7.6 of <xref target=
   'RFC6550'/>.
      </t>
      <t>
   The RPL DODAG Configuration Option is typically placed in
   a DODAG Information Object (DIO) message. The DIO message propagates down the
   DODAG to form and then maintain its structure. The DODAG Configuration Option
   is copied unmodified from parents to children.
      </t>
      <t>
   As shown in <xref target="RPLDCO"/>, the DODAG Configuration Option was
   designed with 4 bit positions reserved for future use as Flags.
   </t>

<figure anchor="RPLDCO">
          <name>DODAG Configuration Option (Partial View) </name>
       <artwork align="center" name="" type="" alt=""><![CDATA[

 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Type = 0x04 |Opt Length = 14| Flags |A|       ...           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                     +
|                               ...                             |
]]></artwork>
</figure>
   <t>
   This specification defines a new flag "Enable RFC8138 Compression" (T).
   The "T" flag is set to turn-on the use of the compression of RPL artifacts
   with <xref target='RFC8138'/> within the DODAG. The new "T" flag is encoded
   in the Flags field in the RPL DODAG Configuration Option. The
   suggested bit position of the "T" flag is indicated in <xref target='iana'/>.
   </t>
   <t>
   <xref target='RFC6550'/> states, when referring to the DODAG Configuration
   Option, that "Nodes other than the DODAG Root MUST
   NOT modify this information when propagating the DODAG Configuration option".
   Therefore, even a legacy parent propagates the "T" flag as set by the Root
   whether it supports this specification or not. So when the "T" flag is set,
   it is transparently flooded to all the nodes in the DODAG.
  </t>


   <t>
   Section 6.3.1.
   of <xref target='RFC6550'/> defines a 3-bit Mode of Operation (MOP) in the
   DIO Base Object. The new "T" flag is defined only for MOP value between 0 to
   6. The compression is implicitely turned on for a MOP value of 7 and above.
   </t>
   </section><!-- Updating RFC 6550-->


   <section><name>Updating RFC 8138</name>



   <t>
   A node SHOULD source packets in the compressed form using
   <xref target='RFC8138'/> if and only if the "T" flag
   is set. This behaviour can be overridden by e.g., configuration or network
   management. Overriding may be needed e.g., to cope with a legacy
   implementations of the Root that supports <xref target='RFC8138'/> but not
   this specification and cannot set the "T" flag.
   </t>
   <t>
   The decision of using <xref target='RFC8138'/> is made by the originator of
   the packet depending on its capabilities and its knowledge of the state of
   the "T" flag.
   A router that encapsulates a packet is the originator of the resulting packet
   and is responsible to compress the outer headers with <xref target='RFC8138'/>, but it MUST leave the encapsulated packet as is.
   </t>
   <t>
   An external target <xref target='I-D.ietf-roll-useofrplinfo'/> is not
   expected to support <xref target='RFC8138'/>.
   In most cases, packets from/to an external target are tunneled back and forth
   between the RPL border router and the Root regardless of the MOP used in the
   RPL DODAG.
   The inner packet is typically not compressed with <xref target='RFC8138'/> so
   the 6LR just needs to decapsulate the (compressed) outer header and forward
   the (uncompressed) inner packet towards the external target.
   </t>
   <t>
   A router MUST uncompress a packet that is to be forwarded to an external
   target. Otherwise, the router MUST forward the packet in the form that the
   source used, either compressed or uncompressed.
   </t>
   <t>
   A RUL <xref target='I-D.ietf-roll-unaware-leaves'/> is both a leaf and an
   external target . A RUL does not participate in RPL and
   depends on the parent router to obtain connectivity. In the case of a RUL,
   forwarding towards an external target actually means delivering the packet.
   </t>



   </section><!-- Updating RFC 8138 -->


   <section><name>Transition Scenarios</name>
   <t>
    A node that supports <xref target='RFC8138'/> but not this specification
    can only be used in an homogeneous network. Enabling the
    <xref target='RFC8138'/> compression requires a "flag day"; all nodes must
    be upgraded, and then the network can be rebooted with the
    <xref target='RFC8138'/> compression turned on.
   </t>
   <t>
   The intent for this specification is to perform a migration once and for all
   without the need for a flag day. In particular it is not the intention to
   undo the setting of the "T" flag. Though it is possible to roll back
   (see <xref target='rb'/>), adding nodes that do not support
   <xref target='RFC8138'/> after a roll back may be problematic if the roll
   back did not fully complete.
   </t>

   <section anchor='coex'><name>Coexistence</name>
   <t>
    A node that supports this specification can operate in a network with the
    <xref target='RFC8138'/> compression turned on or off with the "T" flag set
    accordingly and in a network in transition from off to on or on to off
    (see <xref target='mig'/>).
   </t>
   <t>
    A node that does not support <xref target='RFC8138'/> can interoperate with
    nodes that do in a network with <xref target='RFC8138'/> compression turned
    off. If the compression is turned on, all the RPL-Aware Nodes are expected
    to be able to handle compressed packets in the compressed form. A node that
    cannot do so may remain connected to the network as a RUL, but how the node
    is modified to turn into a RUL is out of scope.
   </t>


   </section><!--Coexistence-->

   <section anchor='mig'><name>Inconsistent State While Migrating</name>

   <t>
   When the "T" flag is turned on by the Root, the
   information slowly percolates through the DODAG as the DIO gets propagated.
   Some nodes will see the flag and start sourcing packets in the compressed
   form while other nodes in the same RPL DODAG are still not aware of it.
   In non-storing mode, the Root will start using
   <xref target='RFC8138'/> with a Source Routing Header 6LoRH (SRH-6LoRH)
   that routes all the way to the parent router or to the leaf.
   </t>

   <t>
   To ensure that a packet is forwarded across the RPL DODAG in the form in
   which it was generated, it is required that all the RPL nodes support
   <xref target='RFC8138'/> at the time of the switch.
   </t>

   <t>
   Setting the "T" flag is ultimately the responsibility of the Network
   Administrator. The expectation is that the network management or upgrading
   tools in place enable the Network Administrator to know when all the nodes
   that may join a DODAG were migrated. In the case of a RPL instance with
   multiple Roots, all nodes that participate to the RPL Instance may
   potentially join any DODAG.
   The network MUST be operated with the "T" flag reset until all nodes in the
   RPL Instance are upgraded to support this specification.
   </t>

   </section> <!--"Transient State while migrating"-->


   <section anchor='rb'><name>Rolling Back</name>

  <t>
   When turning <xref target='RFC8138'/> compression off in the network, the
   Network Administrator MUST wait until all nodes have converged to the
   "T" flag reset before allowing nodes that do not support the compression in
   the network.
  </t>

   <t>
   It is RECOMMENDED to only deploy nodes that support <xref target='RFC8138'/>
   in a network where the compression is turned on. A node that does not support
   <xref target='RFC8138'/> MUST only be used as a RUL.
   </t>

   </section> <!-- Rolling Back -->

   </section> <!-- Transition Scenarios -->

   <section anchor="iana"><name>IANA Considerations</name>
    <t>
    IANA is requested to assign a new option flag from the Registry for the
    "DODAG Configuration Option Flags" that was created for
    <xref target='RFC6550'/> as follows:
    </t>

   <table  anchor="nexndopt"><name>New DODAG Configuration Option Flag</name>
   <thead>
      <tr><td>Bit Number</td><td>Capability Description</td><td>Reference</td></tr>
   </thead><tbody>
      <tr><td>2 (suggested)</td><td>Turn on RFC8138 Compression (T)</td><td>THIS RFC</td></tr>
   </tbody>
   </table>

    <!--t>
    The DODAG Configuration Option Flags defined so far will be obsolete for
    RPL Mode of Operation (MOP) above and including 7.
    </t>
    <t>
    IANA is requested to update the name of the Registry from "DODAG Configuration Option Flags" to "DODAG Configuration Option Flags for RPL MOP 0..6".
    </t>
    <t>
    When MOP values of 7 and more are defined, a new registry will be needed.
    </t-->
   </section>

   <section anchor='sec'><name>Security Considerations</name>
    <t>
   First of all, it is worth noting that with <xref target='RFC6550'/>, every
   node in the LLN that is RPL-aware can inject any RPL-based attack in the
   network.
   A trust model has to be put in place in an effort to exclude rogue nodes from
   participating to the RPL and the 6LoWPAN signaling, as well as from the data
   packet exchange.  This trust model could be at a minimum based on a Layer-2
   Secure joining and the Link-Layer security. This is a generic RPL and 6LoWPAN
   requirement, see Req5.1 in Appendix of <xref target='RFC8505'/>.
 </t>
    <t>
    Setting the "T" flag before all routers are upgraded may cause a loss
    of packets. The new bit is protected as the rest of the configuration so
    this is just one of the many attacks that can happen if an attacker manages
    to inject a corrupted configuration.
    </t><t>
    Setting and resetting the "T" flag may create inconsistencies in the network
    but as long as all nodes are upgraded to <xref target='RFC8138'/> support they will be able
    to forward both forms. The source is responsible
    for selecting whether the packet is compressed or not, and all routers must
    use the format that the source selected. So the result of an inconsistency
    is merely that both forms will be present in the network, at an additional
    cost of bandwidth for packets in the uncompressed form.
    </t>
   </section>

   <section><name>Acknowledgments</name>
   <t>
   The authors wish to thank Alvaro Retana, Dominique Barthel and Rahul Jadhav
   for their in-depth reviews and constructive suggestions.
   </t><t>
   Also many thanks to Michael Richardson for being always helpful and responsive
   when need comes.
   </t>
   </section><!-- ack -->
</middle>

<back>

   <displayreference   target="I-D.ietf-roll-useofrplinfo"     to="USEofRPLinfo"/>
   <displayreference   target="I-D.ietf-roll-unaware-leaves"     to="UNAWARE-LEAVES"/>
    <references><name>Normative References</name>
	  <xi:include href='https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.2119.xml'/> <!-- BCP14 -->
	  <xi:include href='https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.8174.xml'/> <!-- BCP14 -->
	  <xi:include href='https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6550.xml'/> <!-- RPL -->
  <xi:include href='https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7102.xml'/> <!-- RPI -->
  	  <xi:include href='https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.8138.xml'/> <!-- 6LoRH for RPL artifacts -->

  	  <xi:include href='https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.8505.xml'/>
      <!--6LoWPAN ND -->     <xi:include href='https://xml2rfc.tools.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-roll-unaware-leaves.xml'/>

   </references>
   <references><name>Informative References</name>
   	  <xi:include href='https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6553.xml'/> <!-- RPI -->
  <xi:include href='https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7228.xml'/> <!-- termonology -->


      <xi:include href='https://xml2rfc.tools.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-roll-useofrplinfo.xml'/>


   </references>


   <!-- section anchor='dic'><name>Double RPL Instances Scenario</name>
   <t>
   Sections 8.5 and 9.2 of <xref target='RFC6550'/> suggests that a
   RAN may only attach to a DODAG as a leaf when it does
   not support the Mode of Operation of a RPL Instance, the Objective Function
   (OF) as indicated by the Objective Code Point (OCP) or some other parameters
   in the configuration option.
   </t>

   <t>
   This specification reiterates that a RAN that is configured to operate in a
   RPL Instance but does not support a value for a known parameter that is
   mandatory for routing, such as the OCP, MUST NOT operate as a router but MAY
   still join as a leaf. Note that a legacy RAN will not recognize when a
   reserved field is used and will not turn to a leaf when the "T" flag is set.
   </t>

   <t>
   The two RPL Instances operate independently as specified
   in <xref target='RFC6550'/>.  The preexisting RPL Instance does not use
   <xref target='RFC8138'/>, whereas the new RPL Instance does. This is signaled
   by the "T" flag which is only set in the configuration option in DIO messages
   in the new RPL Instance.
   </t>

   <t>
   Nodes that support <xref target='RFC8138'/> participate in both Instances but
   favor the new RPL Instance for the traffic that they source.
   By contrast, nodes that only support the uncompressed format would
   either not be configured for the new RPL Instance, or would be configured to
   join it as leaves only.
   </t>

   <t>
   This method requires implementations to support at least two RPL
   Instances and demands management capabilities to introduce new RPL Instances
   and deprecate old ones.
   </t>

   <t>
   The 2 instances MUST be operated with the same security guarantees, e.g.,
   both "unsecured" with a lower layer security of a same strength, both
   "preinstalled" or both "authenticated" security mode (see section 3.2.3 of
   <xref target='RFC6550'/> for more details on those modes). The latter mode
   could be use to enforce the segregation of updated and non-updated nodes, by
   providing the keys for joining as routers to the updated nodes only.
   </t>


   </section>

   Double Instance Scenario -->


</back>
</rfc>
